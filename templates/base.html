<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>{% block title %}Navidad Familia Soancatl (S)Zacamitzin{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      background: #0b1724;
      color: #fff;
    }
    header {
      background: linear-gradient(135deg, #a81e1e, #0b1724);
      padding: 16px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    header img {
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
    }
    header h1 {
      margin: 0;
      font-size: 1.4rem;
    }
    header p {
      margin: 2px 0 0;
      font-size: 0.9rem;
      opacity: 0.85;
    }
    nav {
      background: #09111b;
      padding: 8px 16px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    nav a {
      color: #fff;
      text-decoration: none;
      font-size: 0.9rem;
      padding: 6px 10px;
      border-radius: 6px;
      background: #1b2836;
    }
    nav a:hover {
      background: #25374c;
    }
    main {
      padding: 16px;
      max-width: 900px;
      margin: 0 auto 60px auto;
    }
    .card {
      background: #101b2a;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    }
    .flash {
      padding: 8px 12px;
      border-radius: 8px;
      margin-bottom: 12px;
      font-size: 0.9rem;
    }
    .flash-danger { background: #8b1e1e; }
    .flash-success { background: #1f6f3f; }
    .flash-info { background: #1f3f6f; }

    label {
      font-size: 0.9rem;
      display: block;
      margin-top: 8px;
    }
    input, select, textarea {
      width: 100%;
      padding: 6px 8px;
      border-radius: 6px;
      border: none;
      margin-top: 2px;
      font-size: 0.9rem;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      background: #e63946;
      color: #fff;
      font-weight: 600;
    }
    button:hover {
      background: #f15b6b;
    }

    /* ===== Bloques con imagen a la derecha (deseos / comidas) ===== */
    .wish-option {
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-top: 10px;
      margin-bottom: 18px;
    }
    .wish-text {
      flex: 1;
      min-width: 0;
      font-size: 0.95rem;
      line-height: 1.4;
      word-wrap: break-word;
      overflow-wrap: anywhere;
    }

    /* Imagen en tarjeta (que se ve completa) */
    .wish-img {
      width: 220px;
      height: 220px;
      border-radius: 12px;
      object-fit: contain;  /* <- ahora se ve COMPLETA */
      background: #000;     /* marquito negro si sobra espacio */
      display: block;
      box-shadow: 0 10px 30px rgba(0,0,0,0.6);
      border: 1px solid rgba(255,255,255,0.25);
      flex-shrink: 0;
      cursor: zoom-in;      /* para que se note que es clickeable */
    }

    @media (max-width: 640px) {
      .wish-option {
        flex-direction: column;
        align-items: flex-start;
      }
      .wish-img {
        width: 100%;
        max-width: 260px;
        height: 220px;
      }
    }

    /* === Botones peque√±os === */
    .btn-small {
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: bold;
      cursor: pointer;
      border: none;
      transition: 0.2s;
      display: inline-block;
    }
    .btn-edit {
      background: #e2b714;
      color: #000;
    }
    .btn-edit:hover { background: #ffdf4d; }
    .btn-delete {
      background: #d62828;
      color: #fff;
    }
    .btn-delete:hover { background: #ff4d4d; }
    .btn-cancel {
      background: #555;
      color: #fff;
    }
    .btn-cancel:hover { background: #777; }

    /* ===== MODAL PARA IMAGEN GRANDE ===== */
    .img-modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .img-modal.open {
      display: flex;
    }
    .img-modal-content {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
    }
    .img-modal-content img {
      display: block;
      max-width: 100%;
      max-height: 90vh;
      border-radius: 12px;
      box-shadow: 0 0 30px rgba(0,0,0,0.8);
    }
    .img-modal-close {
      position: absolute;
      top: -10px;
      right: -10px;
      background: #e63946;
      border-radius: 999px;
      border: none;
      width: 32px;
      height: 32px;
      color: #fff;
      font-size: 1.1rem;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <img src="{{ url_for('static', filename='img/portada_familia.jpg') }}" alt="Familia Soancatl Zacamitzin">
    <div>
      <h1>Navidad Familia Soancatl (S)Zacamitzin üéÑ</h1>
      <p>Invitaci√≥n especial para el 24 de diciembre: regalos, cena y mucho amor familiar.</p>
    </div>

    <!-- Audio navide√±o -->
    <audio id="navidadPlayer"
           controls
           autoplay
           loop
           muted
           playsinline
           style="margin-left:auto; max-width:200px;">
      <source src="{{ url_for('static', filename='navidad.mp3') }}" type="audio/mpeg">
      Tu navegador no soporta audio.
    </audio>
  </header>

  <nav>
    <a href="{{ url_for('index') }}">üè† Inicio</a>
    <a href="{{ url_for('login', next='gift') }}">üéÅ Ver mi intercambio</a>
    <a href="{{ url_for('login', next='dashboard') }}">üìù Mi lista de deseos</a>
    <a href="{{ url_for('foods') }}">üçΩÔ∏è Comidas</a>
    {% if session.get('user_id') %}
      <a href="{{ url_for('logout') }}">üö™ Cerrar sesi√≥n</a>
    {% endif %}
  </nav>

  <main>
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="flash flash-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <!-- MODAL DE IMAGEN GRANDE -->
  <div class="img-modal" id="imgModal">
    <div class="img-modal-content">
      <button class="img-modal-close" id="imgModalClose">&times;</button>
      <img id="imgModalImg" src="" alt="Vista ampliada">
    </div>
  </div>

  <!-- Script: audio + im√°genes grandes -->
  <script>
    (function () {
      /* ==== AUDIO PERSISTENTE ==== */
      const audio = document.getElementById("navidadPlayer");
      if (audio) {
        const KEY_TIME = "navidadAudioTime";
        const KEY_ENABLED = "navidadAudioEnabled";

        function restoreAudioState() {
          try {
            const savedTime = parseFloat(localStorage.getItem(KEY_TIME) || "0");
            const enabled = localStorage.getItem(KEY_ENABLED) === "true";

            audio.addEventListener("loadedmetadata", () => {
              if (!isNaN(savedTime) && savedTime > 0 && savedTime < audio.duration) {
                audio.currentTime = savedTime;
              }
            }, { once: true });

            audio.muted = !enabled;
            audio.play().catch(() => {});
          } catch (e) {
            audio.play().catch(() => {});
          }
        }

        audio.addEventListener("timeupdate", () => {
          try { localStorage.setItem(KEY_TIME, audio.currentTime.toString()); } catch (e) {}
        });

        audio.addEventListener("play", () => {
          try { localStorage.setItem(KEY_ENABLED, (!audio.muted).toString()); } catch (e) {}
        });

        function enableOnFirstInteraction() {
          if (!audio.muted) return;
          audio.muted = false;
          audio.play().catch(() => {});
          try { localStorage.setItem(KEY_ENABLED, "true"); } catch (e) {}

          document.removeEventListener("click", enableOnFirstInteraction);
          document.removeEventListener("touchstart", enableOnFirstInteraction);
        }

        document.addEventListener("click", enableOnFirstInteraction);
        document.addEventListener("touchstart", enableOnFirstInteraction);

        if (document.readyState === "loading") {
          document.addEventListener("DOMContentLoaded", restoreAudioState);
        } else {
          restoreAudioState();
        }
      }

      /* ==== IM√ÅGENES QUE SE AGRANDAN ==== */
      const modal = document.getElementById("imgModal");
      const modalImg = document.getElementById("imgModalImg");
      const modalClose = document.getElementById("imgModalClose");

      function openModal(src) {
        if (!modal || !modalImg) return;
        modalImg.src = src;
        modal.classList.add("open");
      }

      function closeModal() {
        if (!modal || !modalImg) return;
        modal.classList.remove("open");
        modalImg.src = "";
      }

      if (modal) {
        modal.addEventListener("click", (e) => {
          if (e.target === modal) {
            closeModal();
          }
        });
      }
      if (modalClose) {
        modalClose.addEventListener("click", closeModal);
      }

      // Todas las im√°genes con data-fullsrc ser√°n clickeables
      function attachImageListeners() {
        const imgs = document.querySelectorAll(".wish-img[data-fullsrc]");
        imgs.forEach(img => {
          img.addEventListener("click", () => {
            const full = img.getAttribute("data-fullsrc") || img.src;
            openModal(full);
          });
        });
      }

      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", attachImageListeners);
      } else {
        attachImageListeners();
      }
    })();
  </script>
</body>
</html>
