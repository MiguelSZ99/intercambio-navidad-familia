{% extends "base.html" %}

{% block title %}Editar platillo{% endblock %}

{% block content %}
<div class="card">
  <h2>âœï¸ Editar platillo</h2>
  <p>Ajusta el nombre, la descripciÃ³n o la foto de referencia del platillo.</p>

  <form method="post" enctype="multipart/form-data">
    <label for="person_name">Nombre de la persona</label>
    <input type="text" name="person_name" id="person_name"
           value="{{ food.person_name }}" required>

    <label for="title">Nombre del platillo</label>
    <input type="text" name="title" id="title"
           value="{{ food.title }}" required>

    <label for="description">DescripciÃ³n (opcional)</label>
    <textarea name="description" id="description" rows="3" style="white-space: pre-line;">
      {{ food.description or '' }}
    </textarea>

    <label for="food_img">Nueva foto (opcional â€” si subes una nueva, reemplaza la anterior)</label>
    <input type="file" name="food_img" id="food_img" accept="image/*">

    {% if food.image_filename %}
      <p style="margin-top:10px;">Foto actual (haz clic para ampliarla):</p>

      {% set img = food.image_filename %}
      {% if img[:4] == 'http' %}
        <!-- Imagen Cloudinary -->
        <img
          class="wish-img zoomable-image"
          src="{{ img }}"
          data-full="{{ img }}"
          alt="Foto actual del platillo"
        >
      {% else %}
        <!-- Imagen local antigua -->
        <img
          class="wish-img zoomable-image"
          src="{{ url_for('static', filename='uploads/' ~ img) }}"
          data-full="{{ url_for('static', filename='uploads/' ~ img) }}"
          alt="Foto actual del platillo"
        >
      {% endif %}

      <!-- BotÃ³n eliminar solo imagen -->
      <form method="post"
            action="{{ url_for('delete_food_image', food_id=food.id) }}"
            onsubmit="return confirm('Â¿Seguro que quieres eliminar solo la imagen? El platillo seguirÃ¡ registrado.');"
            style="margin-top:12px;">
        <button type="submit" class="btn-small btn-delete">ğŸ—‘ï¸ Borrar solo la imagen</button>
      </form>
    {% endif %}

    <button type="submit" class="btn-small btn-edit" style="margin-top:10px;">
      ğŸ’¾ Guardar cambios
    </button>

    <a href="{{ url_for('foods') }}"
       class="btn-small btn-cancel"
       style="margin-left:8px;">
       Cancelar
    </a>
  </form>
</div>
{% endblock %}
